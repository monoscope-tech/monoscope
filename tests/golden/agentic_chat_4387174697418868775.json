{"accHasTools":true,"accHistory":[{"content":"You are a helpful assistant that converts natural language queries to KQL (Kusto Query Language) filter expressions.\n\nCURRENT TIME (UTC): 2025-01-01 00:00:00 UTC\nUse this to interpret relative time requests (e.g., 'last 2 hours' â†’ {\"since\": \"2H\"})\n\nAvailable telemetry fields for querying logs and spans:\n\nCore fields:\n- body\n- duration\n- kind (logs, span, request)\n- level (TRACE, DEBUG, INFO, WARN, ERROR, FATAL)\n- name\n- severity.number\n- severity.text (TRACE, DEBUG, INFO, WARN, ERROR, FATAL)\n- status_code (OK, ERROR, UNSET)\n- timestamp\n\nHTTP attributes:\n- attributes.http\n- attributes.http.request\n- attributes.http.request.body\n- attributes.http.request.body.size\n- attributes.http.request.method (GET, POST, PUT, DELETE, PATCH, HEAD, OPTIONS)\n- attributes.http.request.method_original\n- attributes.http.request.resend_count\n- attributes.http.response\n- attributes.http.response.status_code\n\nService & Resource:\n- resource.service\n- resource.service.instance\n- resource.service.instance.id\n- resource.service.name\n- resource.service.namespace\n- resource.service.version\n- resource.telemetry\n- resource.telemetry.sdk\n- resource.telemetry.sdk.language\n- resource.telemetry.sdk.name\n\nContext & Tracing:\n- context.is_remote\n- context.span_id\n- context.trace_flags\n- context.trace_id\n- context.trace_state\n- parent_id\n\nError & Exception:\n- attributes.error\n- attributes.error.type\n- attributes.exception\n- attributes.exception.message\n- attributes.exception.stacktrace\n- attributes.exception.type\n\nDatabase:\n- attributes.db\n- attributes.db.collection\n- attributes.db.collection.name\n- attributes.db.namespace\n- attributes.db.operation\n- attributes.db.operation.batch\n- attributes.db.operation.batch.size\n- attributes.db.operation.name\n- attributes.db.query\n- attributes.db.query.summary\n\nUser & Session:\n- attributes.session\n- attributes.session.id\n- attributes.session.previous\n- attributes.session.previous.id\n- attributes.user\n- attributes.user.email\n- attributes.user.full_name\n- attributes.user.hash\n- attributes.user.id\n- attributes.user.name\n\nNetwork:\n- attributes.client\n- attributes.client.address\n- attributes.client.port\n- attributes.network\n- attributes.network.local\n- attributes.network.local.address\n- attributes.network.local.port\n- attributes.network.peer\n- attributes.network.peer.address\n- attributes.network.peer.port\n\n\n\nKQL (Kusto Query Language) SYNTAX:\n\nAvailable Operators:\n- Comparison: == != > < >= <=\n- Set operations: in !in (e.g., method in (\"GET\", \"POST\"))\n- Text search: has !has (case-insensitive word search)\n- Text collections: has_any has_all (e.g., tags has_any [\"urgent\", \"critical\"])\n- String operations: contains !contains startswith !startswith endswith !endswith\n- Pattern matching: matches =~ (regex, e.g., email matches /.*@company\\.com/)\n- Logical: AND OR (or lowercase and or)\n- Duration values: 100ms 5s 2m 1h (nanoseconds, microseconds, milliseconds, seconds, minutes, hours)\n\nVISUALIZATION TYPES (use these exact strings):\n- \"timeseries\": Bar chart with time on X-axis. Use bin_auto(timestamp) in query.\n- \"timeseries_line\": Line chart with time. Use bin_auto(timestamp) in query.\n- \"distribution\": Categorical bar chart (no time). Use summarize...by without bin(). For GROUP BY on non-time fields.\n- \"pie_chart\": Pie chart for proportions. Use summarize...by without bin().\n- \"top_list\": Ranked list of values.\n- \"table\": Raw data rows as table.\n- \"stat\": Single numeric value display.\n- \"heatmap\": Latency distribution heatmap.\n- \"logs\": Log entries list (default when no chart needed).\n\nCATEGORICAL vs TIME-SERIES CHARTS:\n- Time-series: Use bin_auto(timestamp) or bin(timestamp, interval) in GROUP BY -> visualization: 'timeseries' or 'timeseries_line'\n- Categorical: GROUP BY a field WITHOUT time binning -> visualization: 'distribution' or 'pie_chart'\n- Example: 'show requests by service' -> | summarize count() by resource.service.name (no bin!) -> visualization: 'distribution'\n- Example: 'show errors over time' -> | summarize count() by bin_auto(timestamp) -> visualization: 'timeseries'\n\nThe summarize statement can use various aggregation functions like count(), sum(...), avg(...), min(...), max(...), median(...), etc.\n\nTIME BINNING:\n- Use bin_auto(timestamp) by DEFAULT - the system will automatically determine the appropriate bin size based on the time range\n- Only use bin(timestamp, <size>) when the user EXPLICITLY specifies a time interval (e.g., 'by hour', 'per minute', 'in 5m intervals')\n- Examples of when to use hardcoded bins: 'show errors by hour' -> bin(timestamp, 1h), 'count per 30 seconds' -> bin(timestamp, 30s)\n- Examples of when to use bin_auto: 'show error trend', 'graph response times', 'chart requests over time' -> bin_auto(timestamp)\n- IMPORTANT: For categorical grouping (by service, method, etc.), do NOT use bin() at all!\n\nKQL Query Examples:\n- \"show me errors\" -> level == \"ERROR\" (visualization: logs)\n- \"Show me error count over time\" -> query: level == \"ERROR\" | summarize count() by bin_auto(timestamp), visualization: timeseries\n- \"show requests by service\" -> query: | summarize count() by resource.service.name, visualization: distribution\n- \"which services have the most errors?\" -> query: level == \"ERROR\" | summarize count() by resource.service.name, visualization: distribution\n\nIMPORTANT: ONLY use field names from the schema. Do NOT invent or hallucinate field names like 'value', 'count', 'total', etc. If unsure about a field name, use get_schema or get_field_values tools to discover available fields.\n\nOUTPUT FORMAT:\nReturn a JSON object with these fields:\n- \"explanation\": Your analysis/explanation in markdown (optional)\n- \"query\": KQL query string (optional)\n- \"visualization\": widget type string (optional)\n- \"widgets\": Array of widget configs (optional)\n- \"time_range\": Use snake_case fields (optional):\n  - Preferred: {\"since\": \"2H\"} for relative ranges (2H, 30M, 7D, etc.)\n  - Alternative: {\"from\": \"1970-01-01T00:00:00Z\", \"to\": \"1970-01-01T12:00:00Z\"} for absolute ranges (ISO8601 format, these are examples - use valid dates based on current time)\n  - 'since' replaces 'from'/'to' when user wants recent data\n\nWORKFLOW:\n1. For chart/visualization requests:\n   a. First call run_query to execute the query and get actual data\n   b. Analyze the results for patterns, trends, spikes, or anomalies\n   c. Return query + visualization + data-driven explanation\n2. For analysis-only requests, use tools to get data, then provide explanation\n3. For simple KQL translation requests without charts, return just the query\n\nEXPLANATION GUIDELINES:\n- Focus on WHAT THE DATA SHOWS, not what the query does\n- Highlight: top contributors, unusual patterns, trends over time, notable values\n- Be specific with numbers from the actual results\n- BAD: \"This query will aggregate events over time...\"\n- GOOD: \"Traffic peaked at 15:20 with 985 events. The 'monoscope' service accounts for 45% of total volume.\"\n\nResponse format:\n{\n  \"explanation\": \"<Data-driven analysis in markdown>\",\n  \"query\": \"<KQL query>\",\n  \"visualization\": \"<timeseries|distribution|pie_chart|top_list|table|stat|heatmap|logs>\",\n  \"widgets\": [{\"type\": \"timeseries\", \"query\": \"...\", \"title\": \"...\"}],\n  \"time_range\": {\"since\": \"2H\"} OR {\"from\": \"1970-01-01T00:00:00Z\", \"to\": \"1970-01-01T12:00:00Z\"}\n}\n\nWidget structure for visualizations:\n{ \"type\": \"logs|timeseries|timeseries_line|stat\",\n  \"query\": \"KQL query string\",\n  \"title\": \"Widget title\" }\n\nIMPORTANT: Do not use code blocks or backticks. Return raw JSON only.\n","messageData":{"images":null,"name":null,"thinking":null,"tool_calls":null},"role":"System"},{"content":"what services have the most errors?","messageData":{"images":null,"name":null,"thinking":null,"tool_calls":null},"role":"User"},{"content":"","messageData":{"images":null,"name":null,"thinking":null,"tool_calls":[{"function":{"arguments":{"limit":10,"query":"level == \"ERROR\" | summarize count() by resource.service.name"},"name":"run_query"},"id":"call_7AqVoSa0fCnN331Md66pPaba","type":"function"}]},"role":"Assistant"},{"content":"Results (0 rows):\n","messageData":{"images":null,"name":null,"thinking":null,"tool_calls":[{"function":{"arguments":{},"name":""},"id":"call_7AqVoSa0fCnN331Md66pPaba","type":"function"}]},"role":"Tool"},{"content":"","messageData":{"images":null,"name":null,"thinking":null,"tool_calls":[{"function":{"arguments":{},"name":"get_facets"},"id":"call_vNKnNQrHzRVpwmHi4b9YsTGL","type":"function"}]},"role":"Assistant"},{"content":"No facet data available","messageData":{"images":null,"name":null,"thinking":null,"tool_calls":[{"function":{"arguments":{},"name":""},"id":"call_vNKnNQrHzRVpwmHi4b9YsTGL","type":"function"}]},"role":"Tool"}],"accModel":"gpt-4o-mini","accResponse":{"content":"{\n  \"explanation\": \"Currently, there are no recorded errors in the available data across services. This indicates a potentially stable system or an issue with error logging.\",\n  \"query\": \"level == \\\"ERROR\\\" | summarize count() by resource.service.name\",\n  \"visualization\": \"distribution\",\n  \"widgets\": [],\n  \"time_range\": {\"since\": \"2H\"}\n}","messageData":{"images":null,"name":null,"thinking":null,"tool_calls":null},"role":"Assistant"}}