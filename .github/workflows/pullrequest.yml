name:  Build and test

on:
  pull_request:
    branches: [ master ]

jobs:
  runhaskell:
    name: Build and test
    runs-on: ubuntu-latest # or macOS-latest, or windows-latest
    # container: timescale/timescaledb-ha:pg14-latest 
    permissions:
      contents: 'read'
      id-token: 'write'
    steps:
      # - uses: actions/checkout@v2
      # - uses: freckle/stack-cache-action@main
      # - uses: haskell/actions/setup@v1
      #   with:
      #     ghc-version: "9.2.7" # Exact version of ghc to use
      #     # cabal-version: 'latest'. Omitted, but defalts to 'latest'
      #     enable-stack: true
      #     stack-version: "latest"

      # - run: stack --no-terminal build --dependencies-only
      # - run: stack install --local-bin-path=.
      - name: "Install postgresql"
        run: |
          sudo apt-get install gnupg postgresql-common apt-transport-https lsb-release wget
          /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh
          echo "deb https://packagecloud.io/timescale/timescaledb/ubuntu/ $(lsb_release -c -s) main" | sudo tee /etc/apt/sources.list.d/timescaledb.list
          wget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/timescaledb.gpg
          apt update 
          apt install timescaledb-2-postgresql-14
      # - run: stack test


