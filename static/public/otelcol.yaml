receivers:
  otlp:
    protocols:
      grpc:
        endpoint: :4317
        include_metadata: true
      http:
        endpoint: :4318
        include_metadata: true

processors:
  batch:
  memory_limiter:
    check_interval: 1s
    limit_percentage: 75
  groupbytrace:
    wait_duration: 30s
    num_traces: 1000
    num_workers: 2
  attributes:
    actions:
      - key: http.headers
        from_context: http.headers
        action: insert
      - key: grpc.metadata
        from_context: grpc.metadata
        action: insert
  resource:
    attributes:
      - key: http.headers
        from_attribute: http.headers
        action: upsert
      - key: grpc.metadata
        from_attribute: grpc.metadata
        action: upsert

exporters:
  debug:
    verbosity: detailed
  googlecloudpubsub:
    project: past-3
    topic: projects/past-3/topics/otlp-stream-prod
  kafka:
    brokers:
      - srv-captain--redpanda-0:9092
      - srv-captain--redpanda-1:9092
      - srv-captain--redpanda-2:9092
    auth:
      plain_text:
        username: ${env:KAFKA_USERNAME}
        password: ${env:KAFKA_PASSWORD}

extensions:
  health_check:
  pprof:
  zpages:
    endpoint: :55679

service:
  extensions: [health_check, pprof, zpages]
  pipelines:
    logs:
      receivers: [otlp]
      processors: [attributes, resource, memory_limiter, batch]
      exporters: [kafka]
    metrics:
      receivers: [otlp]
      processors: [attributes, resource, memory_limiter, batch]
      exporters: [kafka]
    traces:
      receivers: [otlp]
      processors: [attributes, resource, memory_limiter, groupbytrace, batch]
      exporters: [kafka]
